![SMTscope](axiom-profiler-GUI/assets/html/logo_side_small.png?raw=true "SMTscope")

[Runs online](https://viperproject.github.io/smt-scope/) Â· [Tutorial](https://github.com/viperproject/smt-scope/wiki/Tutorial)

A tool for visualising, analysing and understanding quantifier instantiations made via E-matching in a run of an SMT solver (at present, only [Z3](https://github.com/Z3Prover/z3) has been modified to provide the necessary log files).
The tool takes a log file (which can be generated by Z3 by passing additional command-line options; see below) and presents information visually, primarily using a graph representation of the quantifier instantiations made and their causal connections.
This graph can be filtered and explored in a variety of ways, and detailed explanations of individual quantifier instantiations are assembled and displayed. A range of customisations are available for aiding the presentation and understanding of this information, including explanations of equalities used to justify a quantifier instantiation.

This tool supersedes the [Axiom Profiler](https://github.com/viperproject/axiom-profiler). S<b><sub><sup>MT</sup></sub></b>S<b><sub><sup>COPE</sup></sub></b> is more stable, ~10x faster and is better a debugging z3 performance issues.

More details of the tool's features can be found in the [README](https://github.com/viperproject/axiom-profiler/blob/master/README.md) of the old tool.

> Note: not all features of the old tool are currently implemented: you may still find it useful to use the old tool.

## Obtaining logs from Z3

NOTE: S<b><sub><sup>MT</sup></sub></b>S<b><sub><sup>COPE</sup></sub></b> requires at least version 4.8.5 of z3. To build the latest version of z3 from source follow the instructions at https://github.com/Z3Prover/z3.

Run Z3 with two extra command-line options:

    z3 trace=true proof=true ./input.smt2

This will produce a log file called `./z3.log`.
If you want to specify the target filename, you can pass a third option:

    z3 trace=true proof=true trace-file-name=foo.log ./input.smt2

NOTE: if this takes too long, it is possible to run S<b><sub><sup>MT</sup></sub></b>S<b><sub><sup>COPE</sup></sub></b> with a prefix of a valid log file - you could potentially kill the z3 process and obtain the corresponding partial log. Some users (especially on Windows) have reported that killing z3 can cause a lot of the file contents to disappear; if you observe this problem, it's recommended to copy the log file before killing the process.

Similarly, if you have a log file which takes too long to load into S<b><sub><sup>MT</sup></sub></b>S<b><sub><sup>COPE</sup></sub></b>, hitting Cancel will cause the tool to work with the portion loaded so far.

To correctly parse the log file, we impose a few [restrictions](smt-log-parser/design-docs/restrictions.md) on the smt2 file given to z3.

## Obtaining Z3 logs from various verification tools that use Z3 (feel free to add more)

### Boogie

To obtain a Z3 log with Boogie, use e.g:

    boogie /vcsCores:1 /proverOpt:O:trace=true /proverOpt:O:proof=true ./file.bpl

### Silicon

To obtain a Z3 log with the Viper symbolic execution verifier (Silicon), use e.g:

    silicon --numberOfParallelVerifiers 1 --z3Args "trace=true proof=true" ./file.vpr

If it complains about an unrecognized argument, try escaping the double-quotes. E.g.:

    silicon --numberOfParallelVerifiers 1 --z3Args '"trace=true proof=true"' ./file.vpr
    
on Unix-like systems or:

    silicon --numberOfParallelVerifiers 1 --z3Args """trace=true proof=true""" ./file.vpr

in Windows command prompt.

### Carbon

To obtain a Z3 log with the Viper verification condition generation verifier (Carbon), use e.g:

    carbon --print ./file.bpl ./file.vpr
    boogie /vcsCores:1 /proverOpt:O:trace=true /proverOpt:O:proof=true ./file.bpl

In all cases, the Z3 log should be stored in `./z3.log` (this can also be altered by correspondingly passing z3 the trace-file-name option described above)

### Dafny

See these instructions in Dafny's wiki: [Investigating slow verification performance](https://github.com/dafny-lang/dafny/wiki/Investigating-slow-verification-performance).

```
dafny /compile:0 /print:file.bpl /vcsCores:1 /proverLog:file.smt2 /proverOpt:O:trace-file-name=file.log /proverOpt:O:trace=true /proverOpt:O:proof=true file.dfy
```

To dump the whole chain of `.dfy -> .bpl -> .smt2 -> .log` files, try using the above command.

### FStar

See these instructions in FStar's wiki: [Profiling Z3 queries](https://github.com/FStarLang/FStar/wiki/Profiling-Z3-queries).

### VerCors

Use the `--backend-option` flag to pass instructions to the silicon backend:

```
vercors file.pvl --backend-option --numberOfParallelVerifiers=1 --backend-option --z3Args="trace=true proof=true"
```
